<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏à‡∏∏‡∏î‡∏õ‡∏•‡πà‡∏≠‡∏¢ Wi-Fi ‡∏î‡πâ‡∏ß‡∏¢ Voronoi</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0; padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px);
            padding: 10px 15px;
            display: flex; align-items: center; justify-content: center;
            gap: 12px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            flex-shrink: 0; z-index: 1000;
        }
        
        .header-logo-wrapper {
            width: 45px; height: 45px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            border-radius: 50%;
            background: white;
            padding: 4px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .header-logo { width: 100%; height: 100%; object-fit: contain; }
        .header-content { display: flex; flex-direction: column; }
        .header-title { color: white; font-size: 1.1rem; font-weight: 700; margin: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        .header-subtitle { color: rgba(255, 255, 255, 0.9); font-size: 0.75rem; margin: 2px 0 0 0; }

        /* --- Layout --- */
        #container {
            display: flex; flex-direction: column; 
            flex-grow: 1; width: 100%; overflow: hidden; position: relative;
        }

        #controls {
            width: 100%; padding: 15px; background: white; 
            overflow-y: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 500;
        }

        #map-container {
            flex-grow: 1; position: relative; width: 100%; z-index: 1;
        }

        #map { 
            width: 100%; height: 100%; /* Map fills its container */
            transition: height 0.3s;
        }

        /* --- Fullscreen Map Styles (The Magic Part) --- */
        #map-container.fullscreen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100vw; height: 100vh;
            z-index: 9999;
            background: white;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
        .map-toggle-btn {
            position: absolute;
            top: 10px; left: 10px;
            z-index: 10000; /* ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
            background: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex; align-items: center; gap: 5px;
            transition: all 0.2s;
        }
        .map-toggle-btn:active { transform: scale(0.95); }
        .map-toggle-btn span { font-size: 1.2rem; line-height: 1; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠ Fullscreen */
        #map-container.fullscreen .map-toggle-btn {
            background: #ff5252;
            color: white;
        }

        /* --- UI Elements --- */
        .building-input {
            display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px;
            padding: 8px; background: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef;
        }
        .building-input label { font-size: 0.85rem; font-weight: 600; min-width: 50px; }
        .building-input input { flex: 1; min-width: 80px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 0.9rem; }
        
        button.action-btn {
            width: 100%; padding: 12px; border: none; border-radius: 8px;
            color: white; font-weight: 600; font-size: 0.95rem;
            margin-bottom: 8px; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        #add-building { background: linear-gradient(135deg, #20bf55 0%, #01baef 100%); }
        #process-data { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        #check-signal-btn { background: #546e7a; margin-top: 5px; }
        #check-signal-btn.active { background: #ff5722; animation: pulse 1.5s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

        /* Results & Legend */
        .legend-box { background: #fff8e1; padding: 10px; border-radius: 6px; font-size: 0.8rem; border: 1px solid #ffe082; margin-bottom: 15px; }
        .dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        #results { background: #f1f8e9; padding: 10px; border-radius: 8px; border: 1px solid #c5e1a5; margin-top: 15px; }
        #results h3 { margin: 0 0 5px 0; font-size: 0.9rem; color: #33691e; }
        #vertex-list { list-style: none; padding: 0; margin: 0; font-size: 0.85rem; font-family: monospace; }
        #vertex-list li { margin-bottom: 4px; }

        /* Popup */
        .signal-popup { text-align: center; min-width: 140px; }
        .signal-bars { font-size: 1.1rem; margin: 3px 0; letter-spacing: 2px; }

        /* Footer */
        footer {
            background: rgba(0, 0, 0, 0.3); color: white; text-align: center;
            padding: 5px; font-size: 0.7rem; flex-shrink: 0;
        }

        /* --- Desktop Responsive --- */
        @media (min-width: 768px) {
            #container { flex-direction: row; }
            #controls { 
                width: 350px; height: 100%; border-right: 1px solid #ddd; 
                flex-shrink: 0;
            }
            .header-title { font-size: 1.4rem; }
            /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° Fullscreen ‡∏ö‡∏ô PC ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß */
            .map-toggle-btn { display: none; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-logo-wrapper">
            <img src="https://img2.pic.in.th/pic/LOGO-HONGSON-METAVERSE-MODEL-2.png" alt="Logo" class="header-logo">
        </div>
        <div class="header-content">
            <h1 class="header-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô Wi-Fi (Voronoi)</h1>
            <p class="header-subtitle">‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÉ‡∏ô‡∏û‡∏£‡∏∞‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå‡∏Ø</p>
        </div>
    </header>

    <div id="container">
        <div id="controls">
            <div class="legend-box">
                <div style="font-weight:bold; margin-bottom:5px;">‚ÑπÔ∏è ‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì (Aura)</div>
                <div><span class="dot" style="background: #4CAF50;"></span><strong>5GHz (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß):</strong> ~30m (‡πÅ‡∏£‡∏á/‡∏™‡∏±‡πâ‡∏ô)</div>
                <div style="margin-top:3px;"><span class="dot" style="background: #FFC107;"></span><strong>2.4GHz (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á):</strong> ~70m (‡πÑ‡∏Å‡∏•)</div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <label style="font-weight: 600;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô AP:</label>
                <input type="number" id="wifi-count" min="1" value="2" style="padding: 6px; width: 60px; text-align: center; border:1px solid #ccc; border-radius:4px;">
            </div>
            
            <div id="building-inputs">
                <div class="building-input">
                    <label>‡∏ï‡∏∂‡∏Å 1:</label>
                    <input type="text" class="lat" value="19.312851">
                    <input type="text" class="lng" value="97.965734">
                </div>
                <div class="building-input">
                    <label>‡∏ï‡∏∂‡∏Å 2:</label>
                    <input type="text" class="lat" value="19.312559">
                    <input type="text" class="lng" value="97.965932">
                </div>
                <div class="building-input">
                    <label>‡∏ï‡∏∂‡∏Å 3:</label>
                    <input type="text" class="lat" value="19.312264">
                    <input type="text" class="lng" value="97.965610">
                </div>
            </div>
            
            <button id="add-building" class="action-btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</button>
            <hr style="border:0; border-top:1px solid #eee; margin:10px 0;">
            
            <button id="process-data" class="action-btn">üöÄ 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Aura</button>
            <button id="check-signal-btn" class="action-btn">üì∂ 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</button>

            <div id="results">
                <h3>üìç ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏û‡∏¥‡∏Å‡∏±‡∏î (Lat, Lng)</h3>
                <ul id="vertex-list"><li>- ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° -</li></ul>
            </div>
        </div>

        <div id="map-container">
            <button id="fullscreen-toggle" class="map-toggle-btn">
                <span>‚õ∂</span> ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            </button>
            <div id="map"></div>
        </div>
    </div>
    
    <footer>¬© 2025 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÉ‡∏ô‡∏û‡∏£‡∏∞‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå‡∏Ø</footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Map Setup ---
            const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri', maxZoom: 19
            });
            const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap', maxZoom: 22
            });

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const isMobile = window.innerWidth < 768;

            const map = L.map('map', {
                layers: [satelliteLayer],
                maxZoom: 20,
                zoomControl: false // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏° Zoom ‡πÄ‡∏î‡∏¥‡∏°
            }).setView([19.3126, 97.9657], 18);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Zoom Control ‡πÉ‡∏´‡∏°‡πà (‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô)
            L.control.zoom({ position: 'topright' }).addTo(map);
            
            // Layer Control (‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á)
            L.control.layers({ "‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°": satelliteLayer, "‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏ô‡∏ô": osmLayer }, null, { position: 'bottomright' }).addTo(map);
            
            let markerLayer = L.layerGroup().addTo(map);
            let checkSignalMode = false;
            let currentWifiPoints = [];

            // --- Fullscreen Toggle Logic ---
            const mapContainer = document.getElementById('map-container');
            const toggleBtn = document.getElementById('fullscreen-toggle');
            
            toggleBtn.addEventListener('click', () => {
                mapContainer.classList.toggle('fullscreen');
                map.invalidateSize(); // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡∏ö‡∏≠‡∏Å Map ‡πÉ‡∏´‡πâ render ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
                
                if (mapContainer.classList.contains('fullscreen')) {
                    toggleBtn.innerHTML = '<span>‚ùå</span> ‡∏õ‡∏¥‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠';
                    // ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                    document.body.style.overflow = 'hidden';
                } else {
                    toggleBtn.innerHTML = '<span>‚õ∂</span> ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà';
                    document.body.style.overflow = ''; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ Scroll
                }
            });

            // --- Calculation Logic (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ---
            function calculateVoronoiVertices(points, k, maxIterations = 50) {
                if (points.length === 0 || k <= 0) return [];
                if (k >= points.length) return points.map(p => ({ lat: p.lat, lng: p.lng }));
                let vertices = [];
                for(let i=0; i<k; i++) vertices.push(points[Math.floor(Math.random()*points.length)]);
                for(let iter=0; iter<maxIterations; iter++) {
                    const cells = Array(k).fill().map(() => []);
                    points.forEach(p => {
                        let minDist = Infinity, idx = 0;
                        vertices.forEach((v, i) => {
                            const d = Math.pow(p.lat - v.lat, 2) + Math.pow(p.lng - v.lng, 2);
                            if(d < minDist) { minDist = d; idx = i; }
                        });
                        cells[idx].push(p);
                    });
                    const newVertices = vertices.map((v, i) => {
                        if(cells[i].length === 0) return v;
                        return {
                            lat: cells[i].reduce((s, p) => s + p.lat, 0) / cells[i].length,
                            lng: cells[i].reduce((s, p) => s + p.lng, 0) / cells[i].length
                        };
                    });
                    if(JSON.stringify(vertices) === JSON.stringify(newVertices)) break;
                    vertices = newVertices;
                }
                return vertices;
            }

            function getDistanceFromLatLonInM(lat1, lon1, lat2, lon2) {
                var R = 6371; var dLat = deg2rad(lat2-lat1); var dLon = deg2rad(lon2-lon1); 
                var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
                return R * c * 1000;
            }
            function deg2rad(deg) { return deg * (Math.PI/180) }

            function getSignalBars(dist, type) {
                let bars = 0; let color = '#F44336';
                if (type === '5G') {
                    if (dist <= 10) { bars = 4; color = '#4CAF50'; }
                    else if (dist <= 20) { bars = 3; color = '#8BC34A'; }
                    else if (dist <= 30) { bars = 2; color = '#FFC107'; }
                    else if (dist <= 35) { bars = 1; color = '#FF9800'; }
                } else {
                    if (dist <= 20) { bars = 4; color = '#4CAF50'; }
                    else if (dist <= 45) { bars = 3; color = '#8BC34A'; }
                    else if (dist <= 70) { bars = 2; color = '#FFC107'; }
                    else if (dist <= 85) { bars = 1; color = '#FF9800'; }
                }
                let barHtml = '';
                for(let i=0; i<4; i++) barHtml += `<span style="display:inline-block; width:6px; height:12px; background:${i < bars ? color : '#ddd'}; margin-right:2px; border-radius:2px;"></span>`;
                return { html: barHtml, bars: bars, color: color };
            }

            // --- Event Listeners ---
            const checkBtn = document.getElementById('check-signal-btn');
            checkBtn.addEventListener('click', () => {
                checkSignalMode = !checkSignalMode;
                if(checkSignalMode) {
                    checkBtn.innerHTML = 'üõë ‡πÅ‡∏ï‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)';
                    checkBtn.classList.add('active');
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì ‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏•‡∏¢ (Optional UX)
                    if (window.innerWidth < 768 && !mapContainer.classList.contains('fullscreen')) {
                       toggleBtn.click();
                    }
                } else {
                    checkBtn.innerHTML = 'üì∂ 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì';
                    checkBtn.classList.remove('active');
                }
            });

            map.on('click', (e) => {
                if(!checkSignalMode) return;
                if(currentWifiPoints.length === 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡πà‡∏≠‡∏ô');
                
                const clickLat = e.latlng.lat; const clickLng = e.latlng.lng;
                let minDist = Infinity;
                currentWifiPoints.forEach(p => {
                    const d = getDistanceFromLatLonInM(clickLat, clickLng, p.lat, p.lng);
                    if(d < minDist) minDist = d;
                });
                
                const sig5 = getSignalBars(minDist, '5G');
                const sig24 = getSignalBars(minDist, '2.4G');
                
                const popupContent = `
                    <div class="signal-popup">
                        <h4 style="margin:0 0 5px 0; border-bottom:1px solid #eee; padding-bottom:5px; font-size:0.9rem;">üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</h4>
                        <div style="font-size:0.85rem; margin-bottom:8px;">‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á: <b>${minDist.toFixed(1)} m</b></div>
                        <div style="background:#f5f5f5; padding:4px; border-radius:4px; margin-bottom:4px;">
                            <div class="signal-label">5GHz</div>
                            <div class="signal-bars">${sig5.html}</div>
                        </div>
                        <div style="background:#f5f5f5; padding:4px; border-radius:4px;">
                            <div class="signal-label">2.4GHz</div>
                            <div class="signal-bars">${sig24.html}</div>
                        </div>
                    </div>`;
                L.popup().setLatLng(e.latlng).setContent(popupContent).openOn(map);
            });

            document.getElementById('process-data').addEventListener('click', () => {
                // Reset Mode
                checkSignalMode = false;
                checkBtn.classList.remove('active');
                checkBtn.innerHTML = 'üì∂ 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì';
                
                markerLayer.clearLayers();
                const list = document.getElementById('vertex-list');
                list.innerHTML = '';
                currentWifiPoints = [];

                const buildings = [];
                document.querySelectorAll('.building-input').forEach((div, i) => {
                    const lat = parseFloat(div.querySelector('.lat').value);
                    const lng = parseFloat(div.querySelector('.lng').value);
                    if(!isNaN(lat) && !isNaN(lng)) {
                        buildings.push({ lat, lng });
                        L.marker([lat, lng]).addTo(markerLayer).bindPopup(`<b>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${i+1}</b>`);
                    }
                });

                if(buildings.length === 0) return alert("‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
                const wifiCount = parseInt(document.getElementById('wifi-count').value) || 1;
                
                if(wifiCount === 1) {
                    const latAvg = buildings.reduce((s, b) => s + b.lat, 0) / buildings.length;
                    const lngAvg = buildings.reduce((s, b) => s + b.lng, 0) / buildings.length;
                    currentWifiPoints = [{ lat: latAvg, lng: lngAvg }];
                } else {
                    currentWifiPoints = calculateVoronoiVertices(buildings, wifiCount);
                }

                currentWifiPoints.forEach((p, i) => {
                    const latLng = [p.lat, p.lng];
                    L.circle(latLng, { color: '#FFC107', fillColor: '#FFC107', fillOpacity: 0.15, radius: 70, weight: 1, dashArray: '5, 5' }).addTo(markerLayer);
                    L.circle(latLng, { color: '#4CAF50', fillColor: '#4CAF50', fillOpacity: 0.3, radius: 30, weight: 1 }).addTo(markerLayer);
                    L.circleMarker(latLng, { radius: 5, color: 'white', weight: 2, fillColor: '#f03', fillOpacity: 1 }).addTo(markerLayer);
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà ${i+1}:</strong> ${p.lat.toFixed(5)}, ${p.lng.toFixed(5)}`;
                    list.appendChild(li);
                });

                const bounds = L.latLngBounds([ ...buildings.map(b => [b.lat, b.lng]), ...currentWifiPoints.map(p => [p.lat, p.lng]) ]);
                map.fitBounds(bounds.pad(0.2));
            });

            document.getElementById('add-building').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'building-input';
                div.innerHTML = `<label>‡∏ï‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà:</label><input type="text" class="lat" placeholder="Lat"><input type="text" class="lng" placeholder="Lng">`;
                document.getElementById('building-inputs').appendChild(div);
            });

            // Auto Run
            setTimeout(() => document.getElementById('process-data').click(), 800);
        });
    </script>
</body>
</html>
