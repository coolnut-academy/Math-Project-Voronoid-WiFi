<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô Wi-Fi (Voronoi)</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0; padding: 0;
            background: #f0f2f5;
            height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            padding: 10px 15px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            flex-shrink: 0; z-index: 2000; height: 60px;
        }

        .header-left { display: flex; align-items: center; gap: 15px; }
        
        #hamburger-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            transition: background 0.2s;
        }
        #hamburger-btn:active { background: rgba(255,255,255,0.4); }

        .header-logo-wrapper {
            width: 35px; height: 35px;
            border-radius: 50%;
            background: white;
            padding: 2px;
            display: flex; align-items: center; justify-content: center;
        }
        .header-logo { width: 100%; height: 100%; object-fit: contain; }
        
        .header-title { 
            color: white; font-size: 1rem; font-weight: 600; margin: 0; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* --- Layout --- */
        #container {
            display: flex; flex-grow: 1; width: 100%; 
            position: relative; overflow: hidden;
        }

        #controls {
            background: white;
            width: 320px; height: 100%;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1500;
            padding: 20px;
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        #drawer-overlay {
            position: fixed; top: 60px; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1400;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s;
            backdrop-filter: blur(2px);
        }

        #map { flex-grow: 1; width: 100%; height: 100%; z-index: 1; }

        @media (max-width: 767px) {
            #controls {
                position: absolute; top: 0; left: 0; bottom: 0;
                width: 85%; max-width: 320px;
                transform: translateX(-100%);
            }
            #controls.open { transform: translateX(0); }
            #drawer-overlay.open { opacity: 1; visibility: visible; }
            .drawer-close-btn { display: flex; }
        }

        @media (min-width: 768px) {
            #hamburger-btn { display: none; }
            #controls {
                position: relative; transform: none !important;
                border-right: 1px solid #ddd; width: 350px; flex-shrink: 0;
            }
            #drawer-overlay { display: none; }
            .header-title { font-size: 1.2rem; }
            .drawer-close-btn { display: none !important; }
        }

        /* --- Components --- */
        .drawer-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        .drawer-close-btn {
            background: none; border: none; font-size: 1.5rem; color: #666; cursor: pointer;
            display: none;
        }
        
        .legend-box { background: #fff8e1; padding: 10px; border-radius: 6px; font-size: 0.85rem; border: 1px solid #ffe082; margin-bottom: 15px; }
        .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        
        .building-input {
            display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px;
            padding: 10px; background: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef;
        }
        .building-input label { font-size: 0.9rem; font-weight: 600; min-width: 50px; }
        .building-input input { flex: 1; min-width: 80px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; }

        button.action-btn {
            width: 100%; padding: 12px; border: none; border-radius: 8px;
            color: white; font-weight: 600; margin-bottom: 8px; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-size: 0.95rem; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        #add-building { background: linear-gradient(135deg, #20bf55 0%, #01baef 100%); }
        #process-data { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        #check-signal-btn { background: #546e7a; margin-top: 10px; }
        #check-signal-btn.active { background: #ff5722; animation: pulse 1.5s infinite; }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

        #results { background: #f1f8e9; padding: 10px; border-radius: 8px; border: 1px solid #c5e1a5; margin-top: 15px; }
        #vertex-list { list-style: none; padding: 0; margin: 0; font-family: monospace; font-size: 0.85rem; }
        #vertex-list li { margin-bottom: 5px; border-bottom: 1px dashed #c5e1a5; padding-bottom: 2px; }

        .signal-popup { text-align: center; min-width: 150px; }
        .signal-bars { font-size: 1.2rem; margin: 5px 0; letter-spacing: 2px; }

        footer {
            background: rgba(0, 0, 0, 0.8); color: white; text-align: center;
            padding: 5px; font-size: 0.7rem; flex-shrink: 0; display: none;
        }
        @media (min-width: 768px) { footer { display: block; } }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <button id="hamburger-btn">‚ò∞</button>
            <div class="header-logo-wrapper">
                <img src="https://img2.pic.in.th/pic/LOGO-HONGSON-METAVERSE-MODEL-2.png" alt="Logo" class="header-logo">
            </div>
            <h1 class="header-title">Wi-Fi Planner</h1>
        </div>
    </header>

    <div id="container">
        <div id="drawer-overlay"></div>

        <div id="controls">
            <div class="drawer-header">
                <h3 style="margin:0; color:#333;">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
                <button class="drawer-close-btn" id="close-drawer-btn">√ó</button>
            </div>

            <div class="legend-box">
                <div style="font-weight:bold; margin-bottom:5px;">‚ÑπÔ∏è ‡∏£‡∏±‡∏®‡∏°‡∏µ (Aura)</div>
                <div><span class="dot" style="background: #4CAF50;"></span><strong>5GHz (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß):</strong> ~30m</div>
                <div style="margin-top:3px;"><span class="dot" style="background: #FFC107;"></span><strong>2.4GHz (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á):</strong> ~70m</div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <label style="font-weight: 600;">üì° ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô AP:</label>
                <input type="number" id="wifi-count" min="1" value="2" style="padding: 8px; width: 70px; text-align: center; border:1px solid #ccc; border-radius:4px;">
            </div>
            
            <div id="building-inputs">
                <div class="building-input">
                    <label>‡∏ï‡∏∂‡∏Å 1:</label>
                    <input type="text" class="lat" value="19.312851" placeholder="Lat">
                    <input type="text" class="lng" value="97.965734" placeholder="Lng">
                </div>
                <div class="building-input">
                    <label>‡∏ï‡∏∂‡∏Å 2:</label>
                    <input type="text" class="lat" value="19.312559">
                    <input type="text" class="lng" value="97.965932">
                </div>
                <div class="building-input">
                    <label>‡∏ï‡∏∂‡∏Å 3:</label>
                    <input type="text" class="lat" value="19.312264">
                    <input type="text" class="lng" value="97.965610">
                </div>
            </div>
            
            <button id="add-building" class="action-btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</button>
            <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">
            
            <button id="process-data" class="action-btn">üöÄ 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Aura</button>
            <button id="check-signal-btn" class="action-btn">üì∂ 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</button>

            <div id="results">
                <h4 style="margin:0 0 10px 0; color:#33691e;">üìç ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h4>
                <ul id="vertex-list"><li>- ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• -</li></ul>
            </div>
            <br><br>
        </div>

        <div id="map"></div>
    </div>
    
    <footer>¬© 2025 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÉ‡∏ô‡∏û‡∏£‡∏∞‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå‡∏Ø</footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Hamburger Logic ---
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const closeDrawerBtn = document.getElementById('close-drawer-btn');
            const drawer = document.getElementById('controls');
            const overlay = document.getElementById('drawer-overlay');

            function toggleDrawer() { drawer.classList.toggle('open'); overlay.classList.toggle('open'); }
            function closeDrawer() { drawer.classList.remove('open'); overlay.classList.remove('open'); }

            hamburgerBtn.addEventListener('click', toggleDrawer);
            closeDrawerBtn.addEventListener('click', closeDrawer);
            overlay.addEventListener('click', closeDrawer);

            // --- Map Setup ---
            const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri', maxZoom: 19
            });
            const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap', maxZoom: 22
            });

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á map ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ maxZoom
            const map = L.map('map', {
                layers: [satelliteLayer],
                maxZoom: 20, 
                zoomControl: false
            }).setView([19.3126, 97.9657], 18);

            L.control.zoom({ position: 'topright' }).addTo(map);
            L.control.layers({ "‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°": satelliteLayer, "‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏ô‡∏ô": osmLayer }, null, { position: 'bottomright' }).addTo(map);
            
            let markerLayer = L.layerGroup().addTo(map);
            let checkSignalMode = false;
            let currentWifiPoints = [];

            // --- Helpers ---
            function calculateVoronoiVertices(points, k, maxIterations = 50) {
                if (points.length === 0 || k <= 0) return [];
                if (k >= points.length) return points.map(p => ({ lat: p.lat, lng: p.lng }));
                let vertices = [];
                for(let i=0; i<k; i++) vertices.push(points[Math.floor(Math.random()*points.length)]);
                for(let iter=0; iter<maxIterations; iter++) {
                    const cells = Array(k).fill().map(() => []);
                    points.forEach(p => {
                        let minDist = Infinity, idx = 0;
                        vertices.forEach((v, i) => {
                            const d = Math.pow(p.lat - v.lat, 2) + Math.pow(p.lng - v.lng, 2);
                            if(d < minDist) { minDist = d; idx = i; }
                        });
                        cells[idx].push(p);
                    });
                    const newVertices = vertices.map((v, i) => {
                        if(cells[i].length === 0) return v;
                        return {
                            lat: cells[i].reduce((s, p) => s + p.lat, 0) / cells[i].length,
                            lng: cells[i].reduce((s, p) => s + p.lng, 0) / cells[i].length
                        };
                    });
                    if(JSON.stringify(vertices) === JSON.stringify(newVertices)) break;
                    vertices = newVertices;
                }
                return vertices;
            }

            function getDistanceFromLatLonInM(lat1, lon1, lat2, lon2) {
                var R = 6371; var dLat = deg2rad(lat2-lat1); var dLon = deg2rad(lon2-lon1); 
                var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
                return R * c * 1000;
            }
            function deg2rad(deg) { return deg * (Math.PI/180) }

            function getSignalBars(dist, type) {
                let bars = 0; let color = '#F44336';
                if (type === '5G') {
                    if (dist <= 10) { bars = 4; color = '#4CAF50'; }
                    else if (dist <= 20) { bars = 3; color = '#8BC34A'; }
                    else if (dist <= 30) { bars = 2; color = '#FFC107'; }
                    else if (dist <= 35) { bars = 1; color = '#FF9800'; }
                } else {
                    if (dist <= 20) { bars = 4; color = '#4CAF50'; }
                    else if (dist <= 45) { bars = 3; color = '#8BC34A'; }
                    else if (dist <= 70) { bars = 2; color = '#FFC107'; }
                    else if (dist <= 85) { bars = 1; color = '#FF9800'; }
                }
                let barHtml = '';
                for(let i=0; i<4; i++) barHtml += `<span style="display:inline-block; width:6px; height:12px; background:${i < bars ? color : '#ddd'}; margin-right:2px; border-radius:2px;"></span>`;
                return { html: barHtml, bars: bars, color: color };
            }

            // --- Events ---
            const checkBtn = document.getElementById('check-signal-btn');
            checkBtn.addEventListener('click', () => {
                checkSignalMode = !checkSignalMode;
                if(checkSignalMode) {
                    checkBtn.innerHTML = 'üõë ‡πÅ‡∏ï‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)';
                    checkBtn.classList.add('active');
                    if (window.innerWidth < 768) closeDrawer();
                } else {
                    checkBtn.innerHTML = 'üì∂ 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì';
                    checkBtn.classList.remove('active');
                }
            });

            map.on('click', (e) => {
                if(!checkSignalMode) return;
                if(currentWifiPoints.length === 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡πà‡∏≠‡∏ô');
                
                const clickLat = e.latlng.lat; const clickLng = e.latlng.lng;
                let minDist = Infinity;
                currentWifiPoints.forEach(p => {
                    const d = getDistanceFromLatLonInM(clickLat, clickLng, p.lat, p.lng);
                    if(d < minDist) minDist = d;
                });
                const sig5 = getSignalBars(minDist, '5G');
                const sig24 = getSignalBars(minDist, '2.4G');
                const popupContent = `
                    <div class="signal-popup">
                        <h4 style="margin:0 0 5px 0; border-bottom:1px solid #eee; padding-bottom:5px; font-size:0.9rem;">üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</h4>
                        <div style="font-size:0.85rem; margin-bottom:8px;">‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á: <b>${minDist.toFixed(1)} m</b></div>
                        <div style="background:#f5f5f5; padding:4px; border-radius:4px; margin-bottom:4px;">
                            <div class="signal-label">5GHz</div>
                            <div class="signal-bars">${sig5.html}</div>
                        </div>
                        <div style="background:#f5f5f5; padding:4px; border-radius:4px;">
                            <div class="signal-label">2.4GHz</div>
                            <div class="signal-bars">${sig24.html}</div>
                        </div>
                    </div>`;
                L.popup().setLatLng(e.latlng).setContent(popupContent).openOn(map);
            });

            document.getElementById('process-data').addEventListener('click', () => {
                checkSignalMode = false;
                checkBtn.classList.remove('active');
                checkBtn.innerHTML = 'üì∂ 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì';
                
                markerLayer.clearLayers();
                const list = document.getElementById('vertex-list');
                list.innerHTML = '';
                currentWifiPoints = [];

                const buildings = [];
                document.querySelectorAll('.building-input').forEach((div, i) => {
                    const lat = parseFloat(div.querySelector('.lat').value);
                    const lng = parseFloat(div.querySelector('.lng').value);
                    if(!isNaN(lat) && !isNaN(lng)) {
                        buildings.push({ lat, lng });
                        L.marker([lat, lng]).addTo(markerLayer).bindPopup(`<b>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${i+1}</b>`);
                    }
                });

                if(buildings.length === 0) return alert("‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
                const wifiCount = parseInt(document.getElementById('wifi-count').value) || 1;
                
                if(wifiCount === 1) {
                    const latAvg = buildings.reduce((s, b) => s + b.lat, 0) / buildings.length;
                    const lngAvg = buildings.reduce((s, b) => s + b.lng, 0) / buildings.length;
                    currentWifiPoints = [{ lat: latAvg, lng: lngAvg }];
                } else {
                    currentWifiPoints = calculateVoronoiVertices(buildings, wifiCount);
                }

                currentWifiPoints.forEach((p, i) => {
                    const latLng = [p.lat, p.lng];
                    L.circle(latLng, { color: '#FFC107', fillColor: '#FFC107', fillOpacity: 0.15, radius: 70, weight: 1, dashArray: '5, 5' }).addTo(markerLayer);
                    L.circle(latLng, { color: '#4CAF50', fillColor: '#4CAF50', fillOpacity: 0.3, radius: 30, weight: 1 }).addTo(markerLayer);
                    L.circleMarker(latLng, { radius: 5, color: 'white', weight: 2, fillColor: '#f03', fillOpacity: 1 }).addTo(markerLayer);
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà ${i+1}:</strong> ${p.lat.toFixed(5)}, ${p.lng.toFixed(5)}`;
                    list.appendChild(li);
                });

                // ‚úÖ FIX: ‡∏•‡πá‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà 18 (‡∏Å‡∏±‡∏ô‡∏ã‡∏π‡∏°‡∏•‡∏∂‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô)
                const bounds = L.latLngBounds([ ...buildings.map(b => [b.lat, b.lng]), ...currentWifiPoints.map(p => [p.lat, p.lng]) ]);
                map.fitBounds(bounds.pad(0.2), { maxZoom: 18 });
                
                if(window.innerWidth < 768) closeDrawer();
            });

            document.getElementById('add-building').addEventListener('click', () => {
                const div = document.createElement('div');
                div.className = 'building-input';
                div.innerHTML = `<label>‡∏ï‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà:</label><input type="text" class="lat" placeholder="Lat"><input type="text" class="lng" placeholder="Lng">`;
                document.getElementById('building-inputs').appendChild(div);
            });

            setTimeout(() => document.getElementById('process-data').click(), 800);
        });
    </script>
</body>
</html>
